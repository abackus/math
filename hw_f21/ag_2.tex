
% --------------------------------------------------------------
% This is all preamble stuff that you don't have to worry about.
% Head down to where it says "Start here"
% --------------------------------------------------------------

\documentclass[10pt]{article}

\usepackage[margin=.7in]{geometry}
\usepackage{amsmath,amsthm,amssymb,mathrsfs}
\usepackage{enumitem}
\usepackage{tikz-cd}
\usepackage{mathtools}
\usepackage{amsfonts}
\usepackage{listings}
\usepackage{algorithm2e}
\usepackage{verse,stmaryrd}
\usepackage{fancyvrb}

% Number systems
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\PP}{\mathbb P}
\newcommand{\Aff}{\mathbb A}
\newcommand{\FF}{\mathbb F}
\newcommand{\DD}{\mathbb D}
\renewcommand{\epsilon}{\varepsilon}

\newcommand{\Aut}{\operatorname{Aut}}
\newcommand{\coker}{\operatorname{coker}}
\newcommand{\CVect}{\CC\operatorname{-Vect}}
\newcommand{\Cantor}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\card}{\operatorname{card}}
\newcommand{\dbar}{\overline \partial}
\DeclareMathOperator*{\esssup}{ess\,sup}
\newcommand{\GL}{\operatorname{GL}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\id}{\operatorname{id}}
\newcommand{\Ind}{\operatorname{Ind}}
\newcommand{\Inn}{\operatorname{Inn}}
\newcommand{\interior}{\operatorname{int}}
\newcommand{\lcm}{\operatorname{lcm}}
\newcommand{\mesh}{\operatorname{mesh}}
\newcommand{\LL}{\mathcal L_0}
\newcommand{\Leb}{\mathcal{L}_{\text{loc}}^2}
\newcommand{\Lip}{\operatorname{Lip}}
\newcommand{\ppGL}{\operatorname{PGL}}
\newcommand{\ppic}{\vspace{35mm}}
\newcommand{\ppset}{\mathcal{P}}
\DeclareMathOperator{\proj}{proj}
\DeclareMathOperator*{\Res}{Res}
\newcommand{\Riem}{\mathcal{R}}
\newcommand{\RVect}{\RR\operatorname{-Vect}}
\newcommand{\Sch}{\mathcal{S}}
\newcommand{\SL}{\operatorname{SL}}
\newcommand{\sgn}{\operatorname{sgn}}
\newcommand{\spn}{\operatorname{span}}
\newcommand{\Spec}{\operatorname{Spec}}
\newcommand{\supp}{\operatorname{supp}}
\newcommand{\TT}{\mathcal T}
\DeclareMathOperator{\tr}{tr}

\newcommand{\SymSpec}{\mathbf{Spec}}

\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\curl}{curl}

% Calculus of variations
\DeclareMathOperator{\pp}{\mathbf p}
\DeclareMathOperator{\zz}{\mathbf z}
\DeclareMathOperator{\uu}{\mathbf u}
\DeclareMathOperator{\vv}{\mathbf v}
\DeclareMathOperator{\ww}{\mathbf w}

\DeclareMathOperator{\Olo}{\mathscr O}

% Categories
\newcommand{\Ab}{\mathbf{Ab}}
\newcommand{\Cat}{\mathbf{Cat}}
\newcommand{\Group}{\mathbf{Group}}
\newcommand{\Module}{\mathbf{Module}}
\newcommand{\Set}{\mathbf{Set}}
\DeclareMathOperator{\Fun}{Fun}
\DeclareMathOperator{\Iso}{Iso}

% Complex analysis
\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}

% Logic
\renewcommand{\iff}{\leftrightarrow}
\newcommand{\Henkin}{\operatorname{Henk}}
\newcommand{\PA}{\mathbf{PA}}
\DeclareMathOperator{\proves}{\vdash}

% Group
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Fix}{Fix}
\DeclareMathOperator{\Out}{Out}

% Other symbols
\newcommand{\heart}{\ensuremath\heartsuit}

\DeclareMathOperator{\atanh}{atanh}

% Theorems
\theoremstyle{definition}
\newtheorem*{corollary}{Corollary}
\newtheorem*{falselemma}{Grader's ``Lemma"}
\newtheorem{exer}{Exercise}
\newtheorem{lemma}{Lemma}[exer]
\newtheorem{theorem}[lemma]{Theorem}

\usepackage[backend=bibtex,style=alphabetic,maxcitenames=50,maxnames=50]{biblatex}
\renewbibmacro{in:}{}
\DeclareFieldFormat{pages}{#1}

\begin{document}
\noindent
\large\textbf{Algebraic geometry, HW 2} \hfill \textbf{Aidan Backus} \\
% --------------------------------------------------------------
%                         Start here
% --------------------------------------------------------------\

\begin{exer}[4.1]
Show that every finite morphism is proper.
\end{exer}

Let $f: X \to Y$ be a finite morphism.
By definition, $f$ is an affine morphism of finite type.
Every affine morphism is separated.
To complete the proof, we need to show that every base change of $f$ is closed.

\begin{lemma}
Every base change $f': X' \to Y'$ is finite.
\end{lemma}
\begin{proof}
The property of being finite is local in $Y$, so we may assume that $Y, Y'$ are affine, say $Y = \Spec A$ and $Y' = \Spec A'$.
Then, since $f$ is affine, $X$ is affine, say $X = \Spec B$; then, if $B' = B \otimes_A A'$, $X' = \Spec B'$.
Then $B$ is a finitely generated $A$-module, so there exist $b_1, \dots, b_n \in B$ that $A$-span $B$.
The natural map $\varphi: A \to A'$ given by the base change $Y' \to Y$ induces elements $b_i' = \varphi(1)b_i$ in $B'$.
To see that $b_1', \dots, b_n'$ $A'$-span $B'$, let
$$b' = x \otimes a' \in B \otimes_A A' = B',$$
with $x \in B$ and $a' \in A'$.
Since $b_1, \dots, b_n$ span $B$, there exist $a_1, \dots, a_n \in A$ with $x = \sum_j a_j b_j$.
So
$$b' = \sum_{j=1}^n a_j b_j \otimes a' = \sum_{j=1}^n b_j \otimes \varphi(a_j) a' = \sum_{j=1}^n b_j' \otimes a_j a'.$$
Therefore $b_1, \dots, b_n'$ $A'$-span $B'$, so $B'$ is a finitely generated $A'$-module and hence $f'$ is finite.
\end{proof}

So, it suffices to show that $f$ is closed.
(Then every base change of $f$ will be finite and hence closed, so $f$ will be universally closed.)

\begin{lemma}
We may assume that $f$ is a morphism of affine schemes $\Spec B \to \Spec A$.
\end{lemma}
\begin{proof}
Let $\mathcal U$ be an affine open cover of $Y$; then the pullback $f^* \mathcal U = \{f^{-1}(U) \subseteq X: U \in \mathcal U\}$ is an affine open cover of $X$, since $f$ is affine.
If $X_0 \subseteq X$ is closed, then for every $V = f^{-1}(U) \in f^* \mathcal U$, $X_0 \cap V$ is closed.
If we can show that $f$ is closed if its codomain is affine, then it will follow that $Y_0 = f(X_0)$ satisfies that $Y_0 \cap U$ is closed in $U$.
But then $Y \setminus Y_0 = \bigcup_{U \in \mathcal U} (Y \setminus Y_0) \cap U$ is a union of open sets and therefore is open, so $f$ is closed.
\end{proof}

Let $\varphi: A \to B$ be the induced morphism of rings; then $B$ is a finitely generated $A$-module.
Here I got stuck and peeked at \S7.2 of Vakil's big book, which told me to show:

\begin{lemma}
$\varphi$ is integral.
\end{lemma}
\begin{proof}
Let $b_1, \dots, b_n$ generate $B$ as an $A$-module and let $b \in B$.
Multiplication by $b$ defines an $A$-linear map $S: B \to B$.
By the Cayley-Hamilton theorem, the characteristic polynomial $\chi$ of $S$ satisfies $\chi(S) = 0$, and therefore $\chi(b) = 0$.
So $b$ is integral over $A$.
\end{proof}

Let $X_0$ be a closed subset of $X = \Spec B$.
We want to show that $f(X_0)$ is closed, and to this end we may assume that $X = X_0$.
Let $Y_0 = V(\ker \varphi)$, which is manifestly closed in $Y$ and satisfies $f(X) \subseteq Y_0$.
Since $\varphi$ is integral, the inclusion map $f(X) \to Y_0$ is surjective, so $f(X) = Y_0$ is closed, as desired.

I wanted extra practice with the valuative criterion, so here is an alternative proof with stronger hypotheses.

Let us assume that $X, Y$ are noetherian and $f: X \to Y$ is a finite morphism.
Suppose that $x$ is a $K$-valued point of $X$, so $f \circ x$ is a $K$-valued point of $Y$ and so its image is contained in some open affine $U \subseteq Y$.
So there exist rings $A, B$ such that $U = \Spec B$, $f^{-1}(U) = \Spec A$, and $A$ is a finitely generated $B$-module; and in particular, we can corestrict $x$ to a $K$-valued point of $f^{-1}(U)$ and $f \circ x$ to a $K$-valued point of $U$.

Suppose that we have a valuation ring $R$ in $K$ and a morphism $y: \Spec R \to Y$ making
$$\begin{tikzcd}
\Spec K \arrow[r,"x"] \arrow[d] & X \arrow[d,"f"] \\
\Spec R \arrow[r,"y"] & Y
\end{tikzcd}$$
commute.
Since $R$ is a valuation ring, $R$ is a local ring, and so the image of $y$ is contained in the closure of the image of $f \circ x$.
In particular, the image of $y$ is contained in $U$, so we can corestrict the above diagram to a new commutative diagram:
$$\begin{tikzcd}
\Spec K \arrow[r,"x"] \arrow[d] & \Spec A \arrow[d,"f"] \\
\Spec R \arrow[r,"y"] & \Spec B
\end{tikzcd}$$
Taking the inverse of the functor $\Spec$ we get yet another commutative diagram, now in the category of rings:
$$\begin{tikzcd}
K & A \arrow[l,"x^\sharp"] \\
R \arrow[u] & B \arrow[l, "y^\sharp"] \arrow[u,"f^\sharp"]
\end{tikzcd}$$
We claim that in fact, the image $A'$ of $x^\sharp$ is contained in $R$.
To see this, suppose that $a_1, \dots, a_n$ generate $A$ as a $B$-module.
Then $x^\sharp(a_1), \dots, x^\sharp(a_n)$ generate $A'$ of $A$ as a $B$-module and hence as an $R$-module.
So $f^\sharp$ is integral.
Since valuation rings are integrally closed it follows that $A' \subseteq R$.
Thus we obtain a map filling in the diagram
$$\begin{tikzcd}
K & A \arrow[l,"x^\sharp"] \arrow[dl,"\overline x^\sharp"] \\
R \arrow[u] & B \arrow[l, "y^\sharp"] \arrow[u,"f^\sharp"]
\end{tikzcd}$$
and hence, taking $\Spec$ of the whole thing, we can fill in the diagram
$$\begin{tikzcd}
\Spec K \arrow[r,"x"] \arrow[d] & \Spec A \arrow[d,"f"] \\
\Spec R \arrow[r,"y"] \arrow[ur,"\overline x"] & \Spec B
\end{tikzcd}$$
and then coextend this diagram to finally get the long-coveted, hard-earned diagram
$$\begin{tikzcd}
\Spec K \arrow[r,"x"] \arrow[d] & X \arrow[d,"f"] \\
\Spec R \arrow[r,"y"] \arrow[ur,"\overline x"] & Y
\end{tikzcd}$$
Since $f$ is separated, this diagram uniquely defines $\overline x$.

\begin{exer}[4.3]
Let $X \to S$ be a separated scheme over an affine scheme.
Let $U, V \subseteq X$ be open affine schemes.
Show that $U \cap V$ is affine, but that this hypothesis requires $X$ to be separated.
\end{exer}

We first show that we need to assume $X$ separated.
Let $Y$ be the disjoint union of two affine planes $U, V \cong \Aff^2$ over $\CC$.
We put an equivalence relation $R$ on $Y$ by declaring $u \cong v$ if $u = v$ as an element of $\Aff^2$ and $u,v \neq 0$.
Then $X = Y/R$ is a scheme, since every point of $X$ either is contained in $U$ or $V$, both of which are affine.
But $U \cap V$ is a punctured plane.

There's a cute way to see that punctured planes are not affine using complex analysis, but I suppose this could probably be translated into purely algebraic language.
Suppose that there exists an affine punctured plane $Z$, so there exists a regular function $f: Z \to \Aff^1$ which does not extend to $\Aff^2$.
Taking the restriction of $f$ to any affine open subset $W$ of $Z$ gives a regular function $f_W$ on $W$, but regular functions on open subsets of $\Aff^2$ are actually just rational functions in the complex-analytic sense, and so $f_W$ induces a holomorphic function $f^{an}_{W^{an}}$ on some open subset $W^{an}$ of $\CC^2$.
The $W^{an}$ form an open cover of $\CC^2 \setminus \{(0, 0)\}$, so the $f^{an}$ glue to a holomorphic function
$$f^{an}: \CC^2 \setminus \{(0, 0)\} \to \CC.$$
Now $\{(0, 0)\}$ is compact and $\CC^2$ has complex dimension $\geq 2$, so $f^{an}$ has a Hartogs extension $f^{an}: \CC^2 \to \CC$, which must still be a polynomial since the $f^{an}_{W^{an}}$ were.
Therefore $f$ both extends and does not extend to $\Aff^2$.

Now assume that $X \to S$ is separated.
Then the diagonal morphism over $U \times_S V$ is
$$\delta: U \cap V \to U \times_S V.$$
By assumption, $\delta$ is a closed immersion. Since $U,S,V$ are all affine,
$$U \times_S V = \Spec(\Olo_U(U) \otimes_{\Olo_S(S)} \Olo_V(V))$$
is affine. Therefore $U \cap V$ is affine.

\begin{exer}[5.5a]
Show that the direct image in varieties of a coherent sheaf need not be coherent.
\end{exer}

Consider the unique map of $k$-varieties $f: \Aff^1 \to \Aff^0$.
Since $\Aff^0 = \Spec k$, a coherent sheaf on $\Aff^0$ is a finitely generated $k$-module -- that is, a finite-dimensional vector space.
But
$$f_* \Olo_{\Aff^1}(\Aff^0) = \Olo_{\Aff^1}(\Aff^1) = k[x]$$
which is an infinite-dimensional vector space.

\begin{exer}[5.5b]
Show that a closed immersion is finite.
\end{exer}

We first give a local characterization of closed immersions.
Let $f: X \to Y$ be a closed immersion and suppose that $(U_i)$ is an open affine cover of $Y$, with $V_i = f^{-1}(U_i)$.
By definition,
$$f^\sharp(U_i): \Olo_Y(U_i) \to \Olo_X(V_i)$$
is surjective. Suppose that its kernel is $M_i$. Then $f^\sharp(U_i)$ drops to an isomorphism
$$\varphi_i: \frac{\Olo_Y(U_i)}{M_i} \to \Olo_X(V_i)$$
which also induces a homeomorphism from a closed subset $K_i$ of $U_i$ to $V_i$.
But
$$K_i = \Spec \frac{\Olo_Y(U_i)}{M_i}$$
since $U_i$ is affine.
Therefore $\varphi_i$ induces an isomorphism of schemes $g_i: V_i \to K_i$ and hence $V_i$ is affine and $\Olo_X(V_i)$ is a quotient of $\Olo_Y(U_i)$, and in particular is a finitely generated $\Olo_Y(U_i)$-module.
Therefore $f$ is finite.

\begin{exer}[5.5c]
Show that if $f: X \to Y$ is a finite morphism of noetherian schemes and $\mathscr F$ is a coherent sheaf on $X$, then $f_* \mathscr F$ is coherent.
\end{exer}

Since $f$ is a morphism of noetherian schemes, it is immediate that $\mathscr F$ is quasicoherent, so we just need to check that for every affine open subset $U = \Spec A$ of $Y$, $f_* \mathscr F(U)$ is a finitely generated $A$-module.
Since $f$ is finite, there is a ring $B$ such that $f^{-1}(U) = \Spec B$ and $B$ is a finitely generated $A$-module.
Since $\mathscr F$ is coherent, $\mathscr F(f^{-1}(U))$ is a finitely generated $B$-module, and since $B$ is finitely generated as an $A$-module, this means that
$$f_* \mathscr F(U) = \mathscr F(f^{-1}(U))$$
is a finitely generated $A$-module as well.

\begin{exer}[5.18a]
Let $\mathscr E$ be a locally free sheaf of rank $n$ on $Y$ with symmetric algebra $S(\mathscr E)$.
Let $X = \SymSpec S(\mathscr E)$ have projection morphism $f: X \to Y$.
For every open affine subset $U$ of $Y$ for which $\mathscr E|U$ is free, choose a basis of $\mathscr E$ and let $\psi: f^{-1}(U) \to \Aff^n$ be the trivialization isomorphism.
Show that $(X, f, \{U\}, \{\psi\})$ is a vector bundle of rank $n$ over $Y$ which does not depend on the above choices.
\end{exer}

\begin{exer}[5.18b]
Show that if $f: X \to Y$ is a vector bundle of rank $n$, then the sheaf of sections $\mathscr S$ of $X$ is a locally free $\Olo_Y$-module of rank $n$.
\end{exer}

By definition, we can find an affine open cover $(U_i)$ of $Y$ such that $U_i = \Spec A_i$ for some rings $A_i$, and $f^{-1}(U_i)$ is isomorphic to $\Aff^n_{A_i} = \Spec A[x_1, \dots, x_n]$.
We claim that $\mathscr S|U_i$ is free; to see this, let $V = \Spec A_i[g^{-1}]$ be a distinguished open subset of $U_i$ and let $s \in \mathscr S(V)$.
Since $V$ is affine, we obtain a morphism of $A$-algebras
$$s^\sharp: A[x_1, \dots, x_n, g^{-1}] \to A[g^{-1}]$$
which in turn defines a vector $v(V)(s) \in A[g^{-1}]^n$ by
$$v(V)(s)_j = s^\sharp(x_j).$$
We claim that $v$ is an isomorphism of sheaves
$$v: \mathscr S|U_i \to \Olo_{\Aff^n_{A_i}},$$
which if true certainly proves the claim. TODO...

\begin{exer}[5.18c]
Let $\mathscr E$ be a locally free sheaf of rank $n$ on $Y$, let $X$ be the vector bundle induced by $\mathscr E$, and let $\mathscr S$ be the sheaf of sections of $X$.
Show that $\mathscr S \cong \widehat{\mathscr E}$.
\end{exer}

\begin{exer}[5.18d]
Show that locally free sheaves of rank $n$ on $Y$ are equivalent to vector bundles of rank $n$ on $Y$.
\end{exer}


\end{document}
